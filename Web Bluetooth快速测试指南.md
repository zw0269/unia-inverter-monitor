# Web Bluetooth 快速测试指南

**更新时间**: 2026-02-12

---

## ✅ 已完成的改进

1. ✅ 创建Web Bluetooth API适配器
2. ✅ 创建混合适配器（自动选择真实/模拟蓝牙）
3. ✅ 更新Store使用新适配器
4. ✅ 保持向后兼容（不支持时自动降级）

---

## 🚀 立即测试

### 方法1: 使用真实蓝牙（推荐）

**要求**:
- ✅ Chrome浏览器（56+）或Edge（79+）
- ✅ 访问地址：http://localhost:3001/

**步骤**:
1. 在Chrome中打开：http://localhost:3001/
2. 点击首页"扫描设备"按钮
3. 浏览器会弹出设备选择器
4. 选择您的蓝牙设备
5. 等待连接完成
6. 查看实时数据

### 方法2: 使用模拟数据（备用）

**适用于**:
- 不支持Web Bluetooth的浏览器
- 没有真实蓝牙设备
- 非HTTPS环境

**自动降级**:
应用会自动检测并切换到Mock模拟数据

---

## 🔍 查看使用的适配器

打开浏览器控制台（F12），查看日志：

```javascript
// 使用真实蓝牙
使用 Web Bluetooth API

// 使用模拟数据
Web Bluetooth 不可用，使用 Mock 蓝牙
```

---

## 📱 测试流程

### 1. 打开应用
```
http://localhost:3001/
```

### 2. 点击"扫描设备"
- 首页右上角"连接设备"按钮
- 或首页卡片"扫描设备"按钮

### 3. 选择设备
- Chrome会弹出设备选择器
- 选择要连接的蓝牙设备
- 点击"配对"

### 4. 查看连接状态
- 连接成功后返回首页
- 查看实时数据更新
- 检查功率曲线图

---

## ⚠️ 重要提示

### UUID配置
如果您有真实设备，需要修改UUID：

**文件**: `F:\unia\src\api\bluetooth\web.ts`

```typescript
// 第20-21行，修改为您的设备UUID
private readonly SERVICE_UUID = '0000fff0-0000-1000-8000-00805f9b34fb'
private readonly CHARACTERISTIC_UUID = '0000fff1-0000-1000-8000-00805f9b34fb'
```

### 设备名称过滤
修改扫描过滤器（同一文件，第44-50行）：

```typescript
filters: [
  { namePrefix: '125kW' },      // 改为您的设备名称
  { namePrefix: 'Inverter' },
  { namePrefix: 'BLE' },
  { services: [this.SERVICE_UUID] }
]
```

### 数据协议
修改数据解析逻辑（第152-167行）根据您的设备协议

---

## 🐛 故障排查

### 问题1: 点击扫描无反应
**检查**:
1. 是否使用Chrome/Edge浏览器？
2. 地址是否为localhost？
3. 控制台是否有错误？

**解决**:
- 使用Chrome浏览器
- 确认地址：http://localhost:3001/

### 问题2: 设备选择器为空
**原因**:
- 设备未开启蓝牙
- 设备名称不匹配过滤器
- 设备已连接其他设备

**解决**:
1. 确认设备蓝牙开启
2. 修改过滤器或使用`acceptAllDevices: true`
3. 断开设备其他连接

### 问题3: 连接失败
**可能原因**:
- UUID配置错误
- 设备不支持GATT
- 权限问题

**解决**:
1. 检查UUID配置
2. 查看控制台错误信息
3. 确认设备支持BLE GATT

---

## 📊 测试清单

### 基本功能
- [ ] 点击扫描按钮，弹出设备选择器
- [ ] 选择设备后能够连接
- [ ] 连接成功显示提示
- [ ] 返回首页显示已连接
- [ ] 实时数据正常显示

### 数据功能
- [ ] 接收到蓝牙数据
- [ ] 数据正确解析
- [ ] 页面数据自动更新
- [ ] 图表正常显示

### 异常处理
- [ ] 连接失败有提示
- [ ] 断开连接有提示
- [ ] 设备断开自动检测
- [ ] 不支持浏览器自动降级

---

## 🎯 下一步

### 如果有真实设备
1. 查看设备蓝牙协议文档
2. 修改UUID配置
3. 修改数据解析逻辑
4. 测试真实设备连接

### 如果暂无真实设备
1. 使用Mock模拟数据测试
2. 开发其他功能
3. 等待硬件就绪后再适配

---

## 📞 需要帮助？

### 查看详细文档
`F:\unia\Web Bluetooth使用说明.md`

### 查看代码文件
- Web蓝牙：`src/api/bluetooth/web.ts`
- Mock蓝牙：`src/api/bluetooth/mock.ts`
- 混合适配器：`src/api/bluetooth/hybrid.ts`
- 蓝牙Store：`src/store/modules/bluetooth.ts`

---

**现在就可以测试Web Bluetooth功能了！** 🚀

---

*测试指南由协调者创建*
*最后更新: 2026-02-12*
